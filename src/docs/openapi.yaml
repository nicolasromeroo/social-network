openapi: 3.0.1
info:
  title: Social Media App API
  version: "1.0.0"
  description: >-
    Documentación OpenAPI (Swagger) para la API Express del proyecto "social-media-app".
    Contiene endpoints de autenticación, posts, comentarios y chat.
servers:
  - url: http://localhost:3000/api
    description: Desarrollo local
tags:
  - name: Auth
    description: Endpoints relacionados con autenticación y perfil de usuario
  - name: Posts
    description: Gestión de publicaciones (crear, listar, like)
  - name: Comments
    description: Gestión de comentarios en publicaciones
  - name: Chat
    description: Endpoints / sockets relacionados con chat (documentado de forma básica)
paths:
  /auth/register:
    post:
      tags:
        - Auth
      summary: Registrar nuevo usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUser'
      responses:
        '200':
          description: Usuario registrado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          $ref: '#/components/responses/Conflict'
  /auth/login:
    post:
      tags:
        - Auth
      summary: Login de usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                  format: email
                password:
                  type: string
              required:
                - email
                - password
      responses:
        '200':
          description: Usuario autenticado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
  /auth/profile:
    get:
      tags:
        - Auth
      summary: Obtener perfil del usuario autenticado
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Perfil y posts del usuario
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  user:
                    $ref: '#/components/schemas/User'
                  posts:
                    type: array
                    items:
                      $ref: '#/components/schemas/Post'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /posts/addPost/{uid}:
    post:
      tags:
        - Posts
      summary: Crear un nuevo post (requiere auth)
      description: Publica un nuevo post para el usuario autenticado. `uid` es el id del usuario (se utiliza el token para identificar). El body requiere al menos `text`.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: uid
          schema:
            type: string
          required: true
          description: ID del usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
                isPrivate:
                  type: boolean
              required:
                - text
      responses:
        '200':
          description: Post creado
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  post:
                    $ref: '#/components/schemas/Post'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /posts/all:
    get:
      tags:
        - Posts
      summary: Obtener posts del usuario autenticado
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Lista de posts (mis posts)
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Post'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /posts/likedPost/{pid}:
    post:
      tags:
        - Posts
      summary: Añadir/quitar like a un post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: pid
          schema:
            type: string
          required: true
          description: ID del post
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
              required:
                - userId
      responses:
        '200':
          description: Resultado del like (agregado/quitado)
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  likes:
                    type: integer
        '404':
          $ref: '#/components/responses/NotFound'

  /posts/comment/{pid}:
    get:
      tags:
        - Comments
      summary: Obtener comentarios de un post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: pid
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Lista de comentarios
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Comment'
        '500':
          $ref: '#/components/responses/ServerError'
    post:
      tags:
        - Comments
      summary: Publicar un comentario en un post
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: pid
          schema:
            type: string
          required: true
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
              required:
                - text
      responses:
        '200':
          description: Comentario publicado
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
                  comment:
                    $ref: '#/components/schemas/Comment'
        '500':
          $ref: '#/components/responses/ServerError'

  /posts/updateComment/{id}:
    put:
      tags:
        - Comments
      summary: Actualizar un comentario (restricción: solo hasta 12 horas)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
          description: ID del comentario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                text:
                  type: string
      responses:
        '200':
          description: Comentario actualizado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /posts/deleteComment/{id}:
    delete:
      tags:
        - Comments
      summary: Eliminar un comentario
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Comentario eliminado
          content:
            application/json:
              schema:
                type: object
                properties:
                  msg:
                    type: string
        '500':
          $ref: '#/components/responses/ServerError'

  /chat/ws:
    get:
      tags:
        - Chat
      summary: Punto de entrada (documentación básica) para WebSocket chat
      description: La aplicación usa socket.io; este path documenta el socket pero la interacción se hace por WebSocket.
      responses:
        '200':
          description: Socket IO en /chat (usa socket.io-client/server)
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
        username:
          type: string
        email:
          type: string
          format: email
        avatar:
          type: string
          nullable: true
        followers:
          type: integer
        following:
          type: integer
        posts:
          type: string
        role:
          type: string
        lastLogin:
          type: string
          format: date-time
    CreateUser:
      type: object
      properties:
        username:
          type: string
        email:
          type: string
        password:
          type: string
        avatar:
          type: string
        followers:
          type: integer
        following:
          type: integer
        role:
          type: string
        lastLogin:
          type: string
          format: date-time
      required:
        - username
        - email
        - password
    AuthResponse:
      type: object
      properties:
        msg:
          type: string
        user:
          $ref: '#/components/schemas/User'
        token:
          type: string
    Post:
      type: object
      properties:
        _id:
          type: string
        userId:
          type: string
        text:
          type: string
        image:
          type: string
        createdAt:
          type: string
          format: date-time
        likes:
          type: array
          items:
            type: string
        likesCount:
          type: integer
        isPrivate:
          type: boolean
        comments:
          type: array
          items:
            $ref: '#/components/schemas/Comment'
    Comment:
      type: object
      properties:
        _id:
          type: string
        userId:
          type: string
        postId:
          type: string
        text:
          type: string
        createdAt:
          type: string
          format: date-time
  responses:
    BadRequest:
      description: Solicitud inválida
      content:
        application/json:
          schema:
            type: object
            properties:
              msg:
                type: string
    Conflict:
      description: Conflicto (por ejemplo usuario ya existe)
      content:
        application/json:
          schema:
            type: object
            properties:
              msg:
                type: string
    Unauthorized:
      description: No autorizado / token faltante o inválido
      content:
        application/json:
          schema:
            type: object
            properties:
              msg:
                type: string
    Forbidden:
      description: Operación prohibida
      content:
        application/json:
          schema:
            type: object
            properties:
              msg:
                type: string
    NotFound:
      description: Recurso no encontrado
      content:
        application/json:
          schema:
            type: object
            properties:
              msg:
                type: string
    ServerError:
      description: Error interno del servidor
      content:
        application/json:
          schema:
            type: object
            properties:
              msg:
                type: string
security:
  - bearerAuth: []

x-notes: |
  Asunciones hechas al generar esta especificación:
    - Las rutas del fichero `src/routes/post.routes.js` se han documentado bajo el prefijo `/post`.
    - Algunas rutas usan parámetros con nombres que pueden no coincidir exactamente con los parámetros leídos dentro de los controladores (por ejemplo `id` vs `commentId`). Recomiendo alinear los nombres en el código para evitar errores en tiempo de ejecución.
    - El endpoint de chat está documentado de forma básica porque la comunicación usa socket.io (no endpoints REST detallados).
  Siguientes pasos recomendados:
    - Montar esta especificación con `swagger-ui-express` en tu servidor para visualizarla.
    - Corregir/despejar inconsistencias de nombres de parámetros en controladores vs rutas.
